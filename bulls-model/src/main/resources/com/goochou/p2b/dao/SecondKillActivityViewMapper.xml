<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goochou.p2b.dao.SecondKillActivityViewMapper">
  <resultMap id="BaseResultMap" type="com.goochou.p2b.model.vo.SecondKillActivityView">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="id" jdbcType="INTEGER" property="id" />
    <result column="good_id" jdbcType="INTEGER" property="goodId" />
    <result column="week_day" jdbcType="INTEGER" property="weekDay" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="limit_count" jdbcType="INTEGER" property="limitCount" />
    <result column="stock_count" jdbcType="INTEGER" property="stockCount" />
    <result column="date" jdbcType="DATE" property="date" />
    <result column="start_time" jdbcType="TIME" property="startTime" />
    <result column="kill_time" jdbcType="INTEGER" property="killTime" />
    <result column="begin_time" jdbcType="TIMESTAMP" property="beginTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="price" jdbcType="DECIMAL" property="price" />
    <result column="member_price" jdbcType="DECIMAL" property="memberPrice" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    name, id, good_id, week_day, title, limit_count, stock_count, date, start_time, kill_time, 
    begin_time, end_time, price, member_price
  </sql>
  <select id="selectByExample" parameterType="com.goochou.p2b.model.vo.SecondKillActivityViewExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from second_kill_activity_view
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
    <if test="limitStart != null and limitStart>-1">
      limit ${limitStart} , ${limitEnd}
    </if>
  </select>
  <select id="countByExample" parameterType="com.goochou.p2b.model.vo.SecondKillActivityViewExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from second_kill_activity_view
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
   
   
   <select id="queryAppIndex2WeeksActivity" resultMap="BaseResultMap">
   	select 
	   	`a`.`name` AS `name`,
		`b`.`id` AS `id`,
		`b`.`good_id` AS `good_id`,
		`b`.`week_day` AS `week_day`,
		`b`.`title` AS `title`,
		`b`.`limit_count` AS `limit_count`,
		`b`.`stock_count` AS `stock_count`,
		(curdate() - INTERVAL (date_format(curdate(), '%w') - `b`.`week_day`) DAY) AS `date`,
		`b`.`start_time` AS `start_time`,
		`b`.`kill_time` AS `kill_time`,
		str_to_date(concat((curdate() - INTERVAL (date_format(curdate(), '%w') - `b`.`week_day`) DAY),`b`.`start_time`),'%Y-%m-%d%H:%i:%s') AS `begin_time`,
		(str_to_date(concat((curdate() - INTERVAL (date_format(curdate(), '%w') - `b`.`week_day`) DAY),`b`.`start_time`),'%Y-%m-%d%H:%i:%s') + INTERVAL `b`.`kill_time` MINUTE) AS `end_time`,
		`b`.`price` AS `price`,
		`b`.`member_price` AS `member_price` 
	from t_mall_activity a
	INNER JOIN t_mall_activity_second_kill b on a.id = b.activity_id
	where 
		(curdate() - INTERVAL (date_format(curdate(), '%w') - `b`.`week_day`) DAY) &gt; now() 
		and (curdate() - INTERVAL (date_format(curdate(), '%w') - `b`.`week_day`) DAY) &lt; date_add(now(),interval 14 day)
		and a.`enable`=1 and b.`enable` = 1 
		order by date asc
   </select>
</mapper>
